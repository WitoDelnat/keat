syntax = "proto3";
package keat.core.v1;

import "google/protobuf/any.proto";

service KeatService {
  rpc GetApp(GetAppRequest) returns (GetAppResponse) {}
  rpc CreateApp(CreateAppRequest) returns (CreateAppResponse) {}
  rpc UpdateApp(UpdateAppRequest) returns (UpdateAppResponse) {}

  rpc UpsertAudience(UpsertAudienceRequest) returns (UpsertAudienceResponse) {}
  rpc Toggle(ToggleRequest) returns (ToggleResponse) {}
}

message App {
  optional string name = 1;
  optional string env = 2;
  optional int32 day_offset = 3;
  optional string theme = 4;
  repeated Feature features = 5;
}

message Feature {
  string name = 1;
  optional bool kill = 2;
  repeated google.protobuf.Any rule = 3;
}

message Audience {
  string name = 1;
  optional string key = 2;
  repeated string values = 3;
}

message GetAppRequest {
  string id = 1;
}

message GetAppResponse {
  App app = 1;
}

message CreateAppRequest {
  string name = 1;
  string feature = 2;
}

message CreateAppResponse {
  string id = 1;
  string key = 2;
}

message UpdateAppRequest {
  string app_id = 1;
}

message UpdateAppResponse {
  App app = 1;
}

message UpsertAudienceRequest {
  string name = 1;
  string feature = 2;
}

message UpsertAudienceResponse {
  string id = 1;
  string key = 2;
}

message ToggleRequest {
  string app = 1;
  string feature = 2;
  google.protobuf.Any rule = 3;
}

message ToggleResponse {
  bool success = 1;
}
